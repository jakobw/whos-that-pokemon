<html>
<head>
  <title>Pokemon raten</title>
  <style type="text/css">
    #poke-image {
      height: 350px;
      width: 350px;
    }
  </style>
  <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
  <script type="text/javascript">
    var pokemon = ['bisasam', 'bisaknosp', 'bisaflor', 'glumanda', 'glutexo', 'glurak', 'schiggy', 'schillok', 'turtok', 'raupy', 'safcon', 'smettbo', 'hornliu', 'kokuna', 'bibor', 'taubsi', 'tauboga', 'tauboss', 'rattfratz', 'rattikarl', 'habitak', 'ibitak', 'rettan', 'arbok', 'pikachu', 'raichu', 'sandan', 'sandamer', 'nidoran w', 'nidorina', 'nidoqueen', 'nidoran m', 'nidorino', 'nidoking', 'piepi', 'pixi', 'vulpix', 'vulnona', 'pummeluff', 'knuddeluff', 'zubat', 'golbat', 'myrapla', 'duflor', 'giflor', 'paras', 'parasek', 'bluzuk', 'omot', 'digda', 'digdri', 'mauzi', 'snobilikat', 'enton', 'entoron', 'menki', 'rasaff', 'fukano', 'arkani', 'quapsel', 'quaputzi', 'quappo', 'abra', 'kadabra', 'simsala', 'machollo', 'maschock', 'machomei', 'knofensa', 'ultrigaria', 'sarzenia', 'tentacha', 'tentoxa', 'kleinstein', 'georok', 'geowaz', 'ponita', 'gallopa', 'flegmon', 'lahmus', 'magnetilo', 'magneton', 'porenta', 'dodu', 'dodri', 'jurob', 'jugong', 'sleima', 'sleimok', 'muschas', 'austos', 'nebulak', 'alpollo', 'gengar', 'onix', 'traumato', 'hypno', 'krabby', 'kingler', 'voltobal', 'lektrobal', 'owei', 'kokowei', 'tragosso', 'knogga', 'kicklee', 'nockchan', 'schlurp', 'smogon', 'smogmog', 'rihorn', 'rizeros', 'chaneira', 'tangela', 'kangama', 'seeper', 'seemon', 'goldini', 'golking', 'sterndu', 'starmie', 'pantimos', 'sichlor', 'rossana', 'elektek', 'magmar', 'pinsir', 'tauros', 'karpador', 'garados', 'lapras', 'ditto', 'evoli', 'aquana', 'blitza', 'flamara', 'porygon', 'amonitas', 'amoroso', 'kabuto', 'kabutops', 'aerodactyl', 'relaxo', 'arktos', 'zapdos', 'lavados', 'dratini', 'dragonir', 'dragoran', 'mewtu', 'mew'],
      missing = [],
      current = '';

    for (var i = 1; i <= 151; i++) missing.push(i);

    var showPkmn = function () {
      var nr = missing[Math.floor(Math.random() * missing.length)];

      current = pokemon[nr - 1];
      loadPkmn(nr);
      // when complete splice nr
    };

    var loadPkmn = function (nr) {
      var img = new Image(),
          canvas = document.getElementById('poke-image').getContext('2d');

      canvas.clearRect(0, 0, 350, 350);

      img.onload = function () {
        canvas.drawImage(img, 0, 0);
        var imageData = canvas.getImageData(0, 0, img.width, img.height);

        for (var i = 0; i < imageData.data.length; i += 4) {
          if (imageData.data[i+3] > 100) {
            imageData.data[i] = 10;
            imageData.data[i+1] = 10;
            imageData.data[i+2] = 10;
            imageData.data[i+3] = 255;
          }
        }
        canvas.putImageData(imageData, 0, 0);
      };
      img.src = 'images/' + nr + '.png';
    };

    var checkGuess = function ($input) {
      if ($input.val().toLowerCase() === current) {
        showPkmn();
      }
      $input.val('');
    };

    $(function () {
      showPkmn();

      $('#guess').submit(function(e) {
        checkGuess($(this).find('input'));

        e.preventDefault();
      });
    });
  </script>
</head>
<body>
  <h1>Welches Pokemon ist das?</h1>
  <canvas id="poke-image" height="350" width="350"></canvas>
  <form id="guess">
    <input type="text" />
  </form>
</body>
</html>
